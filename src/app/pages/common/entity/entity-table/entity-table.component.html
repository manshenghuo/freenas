<div fxLayout="column" id="entity-table-component" class="material mat-card mat-card-table">

  <!-- BATCH OPERATIONS START -->
  <div fxLayout="row wrap" fxLayoutAlign="start center" class="multiActionsButton fn-toolbar"
    [ngClass]="{'icons-only': multiActionsIconsOnly}" *ngIf="conf && selection.selected.length > 0"
    [style.display]="selection.selected.length > 0 ? 'block' : 'none'">
    <div fxFlex="100%">
      <div class="multiactions-title" *ngIf="conf.multiActions.length > 0 && !multiActionsIconsOnly">
        <strong>{{"Batch Operations" | translate}}</strong>
      </div>
      <!-- -->
      <div *ngIf="conf.multiActions && conf.multiActions.length > 0" fxLayout="row wrap" fxLayoutGap="16px">
        <span *ngFor="let maction of conf.multiActions" ix-auto ix-auto-type="button" ix-auto-identifier="{{maction?.id}}">
          <!-- DEFAULT -->
          <ng-container *ngIf="!multiActionsIconsOnly">
            <button id="{{ maction?.id }}" mat-button *ngIf="maction.enable" (click)="maction.onClick(this.selection.selected);">
              <mat-icon>{{ maction?.icon }}</mat-icon>&nbsp;<span>{{maction?.label | translate}}</span>
            </button>
          </ng-container>

          <!-- ICONS ONLY -->
          <ng-container *ngIf="multiActionsIconsOnly">
            <button id="{{ maction?.id }}" mat-button matTooltip="{{ maction?.label  | translate }}"
              [matTooltipPosition]=maction?.ttpos *ngIf="maction.enable" (click)="maction.onClick(this.selection.selected);">
              <mat-icon>{{ maction?.icon }}</mat-icon>
            </button>
          </ng-container>

        </span> &nbsp;
      </div>

      <div *ngIf="!conf.multiActions || conf.multiActions.length == 0">
        <span ix-auto ix-auto-type="button" ix-auto-identifier="mdelete">
          <!-- With Labels -->
          <ng-container>
            <button mat-button (click)="doMultiDelete(this.selection.selected);">
              <mat-icon>delete</mat-icon><br><span>{{"Delete" | translate}}</span>
            </button>
          </ng-container>

          <!-- Without Labels -->
          <ng-container>
            <button (click)="doMultiDelete(this.selection.selected);" mat-button
              matTooltip="{{ 'Delete selections'  | translate }}" matTooltipPosition="below">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-container>
        </span >
      </div>

    </div>
  </div>
  <!-- BATCH OPERATIONS END -->

  <div class="table-container">
    <table *ngIf="conf && currentColumns && currentColumns.length > 0 && dataSource" 
      multiTemplateDataRows mat-table 
      [dataSource]="dataSource" matSort
       style="min-width: {{displayedColumns.length * 25}}px;"
      #newEntityTable>
      <ng-container *ngFor="let column of columnsToString(currentColumns, 'prop'); let i = index;">
  
        <!-- Column Template -->
        <ng-container *ngIf="column !== 'expandedDetail' && column !== 'action' && column !== 'multiselect' && column !== 'expansion-chevrons'" 
       matColumnDef="{{column}}">
          <th class="data-column" mat-header-cell *matHeaderCellDef>{{currentColumns[i].name}}</th>
          <td class="data-column" [ngStyle]="{'cursor': checkLength() ? 'auto' : 'pointer'}" mat-cell *matCellDef="let element">{{element[column]}}</td>
        </ng-container>
  
        <!-- Expansion Chevrons -->
        <ng-container *ngIf="column == 'expansion-chevrons'" matColumnDef="{{column}}" stickyEnd>
          <th class="expansion-chevrons-column" mat-header-cell *matHeaderCellDef></th>
          <td class="expansion-chevrons-column" mat-cell *matCellDef="let element" style="text-align:right;cursor: pointer">
            <ng-container *ngIf="hasDetails() === true">
              <ng-container *ngIf="element === expandedElement">
                <mat-icon role="img" fontSet="mdi-set" fontIcon="mdi-chevron-up"></mat-icon>
              </ng-container>
              <ng-container *ngIf="element !== expandedElement">
                <mat-icon role="img" fontSet="mdi-set" fontIcon="mdi-chevron-down"></mat-icon>
              </ng-container>
            </ng-container>
          </td>
        </ng-container>
  
        <!-- Threedot Actions -->
        <ng-container *ngIf="column == 'action'" matColumnDef="{{column}}" stickyEnd>
          <th class="threedot-column" mat-header-cell *matHeaderCellDef></th>
          <td class="threedot-column" mat-cell *matCellDef="let element">
            <app-entity-table-actions [entity]="this" [row]="element"></app-entity-table-actions>
          </td>
        </ng-container>
  
        <!-- Multiselect Checkboxes -->
        <ng-container *ngIf="column == 'multiselect'" matColumnDef="{{column}}" sticky>
          <th class="multiselect-column" mat-header-cell *matHeaderCellDef>
            <mat-checkbox [indeterminate]="selection.hasValue() && !isAllSelected"
              (change)="$event ? masterToggle() : null"
              [checked]="selection.hasValue() && isAllSelected"
              ix-auto ix-auto-type="checkbox" ix-auto-identifier="title">
            </mat-checkbox>
          </th>
          <td class="multiselect-column" [ngStyle]="{'cursor': checkLength() ? 'auto' : 'pointer'}" mat-cell *matCellDef="let element">
            <mat-checkbox 
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(element) : null"
              [checked]="selection.isSelected(element)"
              ix-auto ix-auto-type="checkbox" 
              [ix-auto-identifier]="element[conf.rowIdentifier || 'name']">
            </mat-checkbox>
          </td>
        </ng-container>
  
      </ng-container>
  
      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container *ngIf="element == expandedElement" matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let element" [attr.colspan]="currentColumns.length">
          <div [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
            <app-entity-table-row-details [config]="element" [parent]="this"></app-entity-table-row-details>
          </div>
        </td>
      </ng-container>
  
     
      <tr mat-header-row *matHeaderRowDef="columnsToString(currentColumns, 'prop')"></tr>
      <tr mat-row class="element-row" id="{{element[getFirstKey(element)]}}" 
        ix-auto ix-auto-type="expander" ix-auto-identifier="{{element[getFirstKey(element)]}}"
        *matRowDef="let element; columns: columnsToString(currentColumns, 'prop'); let i = dataIndex;"
        (click)="expandedElement = expandedElement === element ? null : element;">
      </tr>
  
      <ng-container *ngIf="hasDetails() === true">
        <tr mat-row class="details-row" *matRowDef="let row; columns: ['expandedDetail'];"></tr>
      </ng-container>
    </table>
  </div>
 
  <mat-card-footer style="padding: 0 !important">
    <mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>
  </mat-card-footer>

</div>
